# 代理模式 - 静态代理和动态代理（JDK 动态代理、CGlib 动态代理）

本文内容：

```
一、解析
二、实现
```

## 一、解析

> 什么是代理模式

首先，什么是**代理模式**，就好比房东要卖房，房产中介作为房东的代理，代替房东带领买房者参观房子等。在计算机术语中，房东就好比真正的业务处理逻辑，负责真正逻辑处理；而房产中介就好比代理类，业务处理逻辑前后做些数据预处理、数据校验、日志保存等辅助逻辑；而买房者就好比业务逻辑调用处。

> 代理模式的分类

其次，**代理模式**分为静态代理和动态代理。两者的区别在于是否知道其要代理类的实现接口或父类。

**静态代理**在书写代码的时候，需要知道其要代理的类，实现简单，但也正因为如此，缺点十分明显，即每个业务接口都要实现对应的代理类，造成了大量重复代码（比如，这些接口全都需要日志备份处理）。

**动态代理**有两种实现方式，一种是通过 JDK 动态代理，另一种是通过 CGlib 动态代理。两者的区别在于：

* 前者针对实现接口的代理对象，并且该代理类直到被调用时，才由 JVM 根据传进来的业务接口及方法名，利用拦截器和反射机制，动态生成一个实现代理接口的匿名类的字节码文件（.class），然后通过该代理类对象进行方法调用。
* 后者针对类的代理对象，通过将代理对象的字节码文件（.class）文件加载进来，修改其字节码生成一个继承代理类的子类，并继承覆盖父类方法加强。（因此需要注意不能为声明为 final 方法进行代理）

> 用 JDK 动态代理还是 CGLib 动态代理？

可以看 Spring 的原则：

1. 如果目标对象实现了接口，则默认采用 JDK 动态代理实现 AOP
2. 如果目标对象实现了接口，可以强制使用 CGLib 实现 AOP
3. 如果目标对象没有实现接口，则必须使用 CGLib 库，Srping 会自动在两种代理方式之间切换。

## 二、实现

| 代理方式         | 代码 | 链接                       |
| ---------------- | ---- | -------------------------- |
| 静态代理         | Java | [link](src/StaticProxy/)   |
| 动态代理 - JDK   | Java | [link](src/DynamicProxy1/) |
| 动态代理 - CGlib | Java | [link](src/DynamicProxy2/) |

